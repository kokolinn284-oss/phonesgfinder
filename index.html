<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlinThit ဖုန်းမှန်ကပ် ရှာဖွေရေး</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for 3D effect and gradients */
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(to bottom right, #e0f2fe, #fce4ec, #e3f2fd); /* Light blue, light pink, light blue */
        }
        .card-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04), 0 0 0 8px rgba(168, 85, 247, 0.1); /* Tailwind's shadow-2xl with a purple ring */
        }
        .button-gradient-purple {
            background-image: linear-gradient(to right, #8b5cf6, #6366f1); /* Purple to Indigo */
        }
        .button-gradient-pink {
            background-image: linear-gradient(to right, #ec4899, #ef4444); /* Pink to Red */
        }
        .button-hover-scale:hover {
            transform: scale(1.05);
        }
        .input-focus:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.5); /* Purple ring on focus */
            border-color: #a855f7; /* Purple border on focus */
        }
        /* Ensure table cells don't have extra whitespace that causes DOM nesting warnings */
        th, td {
            white-space: nowrap; /* Prevent wrapping in cells */
        }
    </style>
</head>
<body class="gradient-bg min-h-screen p-4 sm:p-6 lg:p-8 text-gray-800">
    <div class="max-w-4xl mx-auto bg-white rounded-3xl card-shadow p-6 sm:p-8 transform transition-all duration-300 hover:shadow-xl hover:shadow-purple-300">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-purple-800 mb-6 drop-shadow-md">
            <span role="img" aria-label="sparkles">✨</span> AlinThit ဖုန်းမှန်ကပ် ရှာဖွေရေး <span role="img" aria-label="phone">📱</span>
        </h1>

        <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl relative mb-6 shadow-md" role="alert">
            <strong class="font-bold">Error!</strong>
            <span id="error-text" class="block sm:inline ml-2"></span>
            <button id="retry-button" class="ml-4 px-4 py-2 bg-red-600 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-red-700 transition transform hover:scale-105 duration-200">
                ပြန်လည်ကြိုးစားပါ
            </button>
        </div>

        <!-- Search Inputs and Buttons -->
        <div class="mb-8 flex flex-col gap-4">
            <!-- Brand Dropdown -->
            <div class="w-full">
                <label for="brand-select" class="block text-sm font-semibold text-gray-700 mb-2">Brand:</label>
                <select
                    id="brand-select"
                    class="w-full p-3 border border-purple-300 rounded-xl shadow-inner focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white text-gray-800 transition transform duration-200 hover:scale-[1.01] input-focus"
                >
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>

            <!-- Single Search Input -->
            <div class="w-full">
                <label for="search-input" id="search-label" class="block text-sm font-semibold text-gray-700 mb-2">Model နာမည် ရိုက်ထည့်ပါ:</label>
                <input
                    id="search-input"
                    type="text"
                    placeholder="Model နာမည် ရှာဖွေပါ..."
                    class="w-full p-3 border border-purple-300 rounded-xl shadow-inner focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white text-gray-800 placeholder-gray-400 transition transform duration-200 hover:scale-[1.01] input-focus"
                />
            </div>

            <!-- Data and Code Search Buttons -->
            <div class="flex flex-col sm:flex-row justify-center gap-3 mt-2">
                <button
                    id="search-mode-data"
                    class="flex-1 px-6 py-3 rounded-full font-bold text-white shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-xl button-gradient-purple"
                >
                    <span role="img" aria-label="model">📱</span> Model နာမည်ဖြင့် ရှာဖွေပါ
                </button>
                <button
                    id="search-mode-code"
                    class="flex-1 px-6 py-3 rounded-full font-bold text-white shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-xl bg-gray-400 hover:bg-gray-500"
                >
                    <span role="img" aria-label="code">🔢</span> Code ဖြင့် ရှာဖွေပါ
                </button>
            </div>
        </div>

        <!-- Display area for results -->
        <div class="bg-gray-50 rounded-xl shadow-inner p-4 overflow-x-auto border border-gray-200">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider rounded-tl-lg">Brand</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Data (Model Name)</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Code</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Price</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider rounded-tr-lg">Inches</th>
                    </tr>
                </thead>
                <tbody id="results-table-body" class="bg-white divide-y divide-gray-100">
                    <!-- Results will be populated by JavaScript -->
                </tbody>
            </table>
            <p id="no-results-message" class="text-center text-gray-500 py-6 hidden">
                ရှာဖွေတွေ့ရှိသည့် အချက်အလက် မရှိပါ။
            </p>
        </div>
    </div>

    <script>
        // Sample data - This will be replaced by fetched data from Google Sheet
        let allData = [
            { brand: 'Samsung', data: 'Galaxy A12', code: 'SM-A12', privacy: '', procode: '', price: '15000', inches: '6.5', remark: 'Good quality' },
            { brand: 'Xiaomi', data: 'Redmi Note 10', code: 'XM-R10', privacy: '', procode: '', price: '12000', inches: '6.67', remark: 'Popular model' },
            { brand: 'Oppo', data: 'F19 Pro', code: 'OP-F19', privacy: '', procode: '', price: '14000', inches: '6.4', remark: 'Clear view' },
            { brand: 'Samsung', data: 'Galaxy S21', code: 'SM-S21', privacy: '', procode: '', price: '20000', inches: '6.1', remark: 'Flagship model' },
            { brand: 'Vivo', data: 'Y20', code: 'VV-Y20', privacy: '', procode: '', price: '13500', inches: '6.58', remark: 'Budget friendly' },
            { brand: 'Samsung', data: 'Galaxy A52', code: 'SM-A52', privacy: '', procode: '', price: '16000', inches: '6.7', remark: 'Mid-range' },
            { brand: 'Redmi', data: 'Note 10 Pro', code: 'XM-R10', privacy: '', procode: '', price: '13000', inches: '6.67', remark: 'Upgraded version' },
            { brand: 'Huawei', data: 'P40 Lite', code: 'HW-P40', privacy: '', procode: '', price: '18000', inches: '6.3', remark: 'High end' },
            { brand: 'Oppo', data: 'A74', code: 'OP-A74', privacy: '', procode: '', price: '14500', inches: '6.7', remark: 'New arrival' },
            { brand: 'Samsung', data: 'Galaxy Note 20', code: 'SM-N20', privacy: '', procode: '', price: '25000', inches: '6.9', remark: 'Premium' },
            { brand: 'Vivo', data: 'Y20s', code: 'VV-Y20', privacy: '', procode: '', price: '14000', inches: '6.58', remark: 'Slightly better' },
            { brand: 'Infinix', data: 'Infinix G96', code: 'M15', privacy: '', procode: '', price: '10000', inches: '6.7', remark: 'Budget Gaming' },
            { brand: 'Infinix', data: 'Infinix Note 12(G96)', code: 'M15', privacy: '', procode: '', price: '11000', inches: '6.7', remark: 'Gaming Phone' },
            { brand: 'Itel', data: 'Itel A49', code: 'M13', privacy: '', procode: '', price: '8000', inches: '6.6', remark: 'Entry Level' },
            { brand: 'Itel', data: 'Itel P65', code: 'M13', privacy: '', procode: '', price: '9000', inches: '6.5', remark: 'Value Buy' },
            { brand: 'Redmi', data: 'Redmi 9A', code: 'M14', privacy: '', procode: '', price: '9500', inches: '6.53', remark: 'Basic Smartphone' },
            { brand: 'ZTE', data: 'ZTE Nubia V50', code: 'M15', privacy: '', procode: '', price: '16000', inches: '6.67', remark: 'Flagship Killer' },
        ];

        let filteredResults = [];
        let brandFilter = 'All Brands';
        let searchTerm = '';
        let searchMode = 'data'; // 'data' or 'code'

        // Google Sheet CSV URL (Make sure your Google Sheet is published to web as CSV)
        // Columns should be: brand, data, code, privacy, procode, inches, price, remark
        // The 'data' column in your sheet should contain the Model Names.
        // Please ensure this URL is correctly obtained from File > Share > Publish to web > CSV
        const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT2QjUMrH3CiEx_6cVDyC0ylyDr0vK5d3O15KTZpq3poJJwPqbHfiKag2-nQU8BvMgrakJ-cpRcKGxn/pub?gid=0&single=true&output=csv';

        // --- DOM Elements ---
        const brandSelect = document.getElementById('brand-select');
        const searchInput = document.getElementById('search-input');
        const searchLabel = document.getElementById('search-label');
        const searchModeDataButton = document.getElementById('search-mode-data');
        const searchModeCodeButton = document.getElementById('search-mode-code');
        const resultsTableBody = document.getElementById('results-table-body');
        const noResultsMessage = document.getElementById('no-results-message');
        const errorMessageDiv = document.getElementById('error-message');
        const errorTextSpan = document.getElementById('error-text');
        const retryButton = document.getElementById('retry-button');

        // --- Utility Functions ---

        // Simple CSV parser (assumes first row is header)
        function parseCSV(csv) {
            const lines = csv.split('\n');
            if (lines.length <= 1) return []; // Return empty if no data rows

            const headers = lines[0].split(',').map(header => header.trim().toLowerCase());
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i].split(',');
                if (currentLine.length === headers.length && currentLine.some(cell => cell.trim() !== '')) {
                    const rowObject = {};
                    for (let j = 0; j < headers.length; j++) {
                        rowObject[headers[j]] = currentLine[j] ? currentLine[j].trim() : '';
                    }
                    data.push(rowObject);
                }
            }
            return data;
        }

        // Function to fetch data from the Google Sheet URL
        async function fetchData() {
            showLoading(true);
            hideError();
            try {
                console.log("Attempting to fetch data from URL:", GOOGLE_SHEET_CSV_URL);
                const response = await fetch(GOOGLE_SHEET_CSV_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                }
                const csvText = await response.text();
                const parsedData = parseCSV(csvText);
                if (parsedData.length > 0) {
                    allData = parsedData; // Update global allData
                } else {
                    showError("Google Sheet မှ အချက်အလက်များ ဗလာဖြစ်နေပါသည်။ နမူနာအချက်အလက်များ ပြသထားပါသည်။");
                }
            } catch (e) {
                console.error("Error fetching data:", e);
                showError(`အချက်အလက်များ ရယူရာတွင် အမှားအယွင်း ဖြစ်ပွားခဲ့ပါသည်။ ကျေးဇူးပြု၍ URL ကို စစ်ဆေးပါ သို့မဟုတ် Google Sheet ကို 'Publish to web' အဖြစ် မှန်ကန်စွာ ထုတ်ဝေထားခြင်း ရှိမရှိ စစ်ဆေးပါ။ (Error: ${e.message})`);
            } finally {
                showLoading(false);
                updateUI(); // Update UI after fetching data
            }
        }

        // --- UI Update Functions ---

        function showLoading(isLoading) {
            // In a simple HTML/JS app, you might show/hide a spinner.
            // For now, we just manage the error message.
        }

        function showError(message) {
            errorMessageDiv.classList.remove('hidden');
            errorTextSpan.textContent = message;
        }

        function hideError() {
            errorMessageDiv.classList.add('hidden');
            errorTextSpan.textContent = '';
        }

        function populateBrandDropdown() {
            const brands = new Set(allData.map(item => item.brand).filter(Boolean));
            const uniqueBrands = ['All Brands', ...Array.from(brands).sort()];

            brandSelect.innerHTML = ''; // Clear existing options
            uniqueBrands.forEach(brand => {
                const option = document.createElement('option');
                option.value = brand;
                option.textContent = brand;
                brandSelect.appendChild(option);
            });
            brandSelect.value = brandFilter; // Set selected value
        }

        function renderResults() {
            resultsTableBody.innerHTML = ''; // Clear existing results

            if (filteredResults.length === 0) {
                noResultsMessage.classList.remove('hidden');
                return;
            } else {
                noResultsMessage.classList.add('hidden');
            }

            filteredResults.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-blue-50 transition duration-150 ease-in-out';
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${item.brand || ''}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${item.data || ''}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${item.code || ''}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${item.price || ''}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${item.inches || ''}</td>
                `;
                resultsTableBody.appendChild(row);
            });
        }

        function updateSearchInputPlaceholder() {
            if (searchMode === 'data') {
                searchLabel.textContent = 'Model နာမည် ရိုက်ထည့်ပါ:';
                searchInput.placeholder = 'Model နာမည် ရှာဖွေပါ...';
            } else {
                searchLabel.textContent = 'Code ရိုက်ထည့်ပါ:';
                searchInput.placeholder = 'Code ရှာဖွေပါ...';
            }
        }

        function updateSearchModeButtons() {
            searchModeDataButton.classList.remove('button-gradient-purple', 'bg-gray-400', 'hover:bg-gray-500');
            searchModeCodeButton.classList.remove('button-gradient-pink', 'bg-gray-400', 'hover:bg-gray-500');

            if (searchMode === 'data') {
                searchModeDataButton.classList.add('button-gradient-purple');
                searchModeCodeButton.classList.add('bg-gray-400', 'hover:bg-gray-500');
            } else {
                searchModeCodeButton.classList.add('button-gradient-pink');
                searchModeDataButton.classList.add('bg-gray-400', 'hover:bg-gray-500');
            }
        }

        // --- Filtering Logic ---
        function applyFilters() {
            let currentResults = allData;

            // Apply brand filter first if not 'All Brands'
            if (brandFilter !== 'All Brands') {
                currentResults = currentResults.filter(item => {
                    return item.brand && String(item.brand).toLowerCase().includes(brandFilter.toLowerCase());
                });
            }

            // Apply main search term based on searchMode
            if (searchTerm !== '') {
                const lowerCaseSearchTerm = searchTerm.toLowerCase();

                if (searchMode === 'data') {
                    const matchingCodes = new Set();
                    let exactMatchItem = null;

                    allData.forEach(item => {
                        if (item.data) {
                            const itemDataLowerCase = String(item.data).toLowerCase();
                            if (itemDataLowerCase === lowerCaseSearchTerm) {
                                exactMatchItem = item;
                            }
                            if (itemDataLowerCase.includes(lowerCaseSearchTerm)) {
                                if (item.code) {
                                    matchingCodes.add(String(item.code).toLowerCase());
                                }
                            }
                        }
                    });

                    if (matchingCodes.size > 0) {
                        let tempResults = currentResults.filter(item => {
                            return item.code && matchingCodes.has(String(item.code).toLowerCase());
                        });

                        if (exactMatchItem) {
                            const exactMatchIndex = tempResults.findIndex(item => 
                                item.brand === exactMatchItem.brand && 
                                item.data === exactMatchItem.data && 
                                item.code === exactMatchItem.code
                            );
                            if (exactMatchIndex > -1) {
                                const [removedItem] = tempResults.splice(exactMatchIndex, 1);
                                tempResults.unshift(removedItem);
                            }
                        }
                        currentResults = tempResults;

                    } else {
                        currentResults = [];
                    }
                } else if (searchMode === 'code') {
                    currentResults = currentResults.filter(item => {
                        return item.code && String(item.code).toLowerCase().includes(lowerCaseSearchTerm);
                    });
                }
            }

            filteredResults = currentResults; // Update global filteredResults
            renderResults(); // Re-render table with new results
        }

        function updateUI() {
            populateBrandDropdown();
            updateSearchInputPlaceholder();
            updateSearchModeButtons();
            applyFilters(); // Apply filters and render results
        }

        // --- Event Listeners ---
        brandSelect.addEventListener('change', (e) => {
            brandFilter = e.target.value;
            applyFilters();
        });

        searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value;
            applyFilters();
        });

        searchModeDataButton.addEventListener('click', () => {
            searchMode = 'data';
            updateUI(); // Update UI and re-apply filters
        });

        searchModeCodeButton.addEventListener('click', () => {
            searchMode = 'code';
            updateUI(); // Update UI and re-apply filters
        });

        retryButton.addEventListener('click', fetchData);

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchData(); // Fetch data when the page loads
        });
    </script>
</body>
</html>
